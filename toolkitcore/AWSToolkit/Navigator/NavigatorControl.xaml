<commonui:BaseAWSUserControl x:Class="Amazon.AWSToolkit.Navigator.NavigatorControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:commonui="clr-namespace:Amazon.AWSToolkit.CommonUI"                      
    xmlns:commoncomponents="clr-namespace:Amazon.AWSToolkit.CommonUI.Components"
    xmlns:localnode="clr-namespace:Amazon.AWSToolkit.Navigator.Node"             
    >

    <DockPanel>
        <DockPanel.Resources>
            <ResourceDictionary>
                <ResourceDictionary.MergedDictionaries>
                    <ResourceDictionary Source="pack://application:,,,/AWSToolkit;component/Themes/DefaultTheme.xaml"/>
                </ResourceDictionary.MergedDictionaries>
                <Style TargetType="{x:Type Image}">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType={x:Type UIElement}, AncestorLevel=1}, Path=IsEnabled}" Value="False">
                            <Setter Property="Opacity" Value="0.3"></Setter>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>

                <Style TargetType="ToolTip">
                    <Setter Property="ContentTemplate">
                        <Setter.Value>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding}" MaxWidth="300" TextWrapping='Wrap'/>
                                </StackPanel>
                            </DataTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>

                <Style x:Key="navigatorTreeViewItemStyle" TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource awsTreeViewItemStyle}">
                    <Setter Property="IsExpanded" Value="{Binding Path=(localnode:ITreeNodeProperties.IsExpanded), Mode=TwoWay}" />
                    <Setter Property="IsSelected" Value="{Binding Path=(localnode:ITreeNodeProperties.IsSelected), Mode=TwoWay}" />
                </Style>

            </ResourceDictionary>
        </DockPanel.Resources>

        <Grid DockPanel.Dock="Top" Background="{DynamicResource awsHorizontalToolBarBackgroundBrushKey}">
            <Grid.Resources>
                <Style TargetType="{x:Type Button}" BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}" />
            </Grid.Resources>

            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Margin="5,3,5,3" Grid.Row="0" Grid.Column="0" 
                       VerticalAlignment="Center" FontWeight="Bold" 
                       Foreground="{DynamicResource awsToolBarTextBrushKey}"
                       Text="Profile:"
                       />

            <commoncomponents:RegisteredProfilesPicker Margin="5,3,5,3" Grid.Row="0" Grid.Column="1"
                     x:Name="_ctlAccounts"
                     />

            <Button Margin="0,3,0,3" Grid.Row="0" Grid.Column="2"  Click="addAccount" ToolTip="New Account Profile">
                <Image DataContext="{DynamicResource CommonIcons}" Source="{Binding AddAccountIcon}" Width="16" Height="16"></Image>
            </Button>
            <Button Margin="0,3,0,3" Grid.Row="0" Grid.Column="3" Click="editAccount" Name="_ctlEditAccount" ToolTip="Edit Profile">
                <Image DataContext="{DynamicResource CommonIcons}" Source="{Binding EditAccountIcon}" Width="16" Height="16"></Image>
            </Button>
            <Button Margin="0,3,0,3" Grid.Row="0" Grid.Column="4" DockPanel.Dock="Right" Click="deleteAccount" Name="_ctlDeleteAccount" ToolTip="Delete Profile">
                <Image DataContext="{DynamicResource CommonIcons}" Source="{Binding DeleteAccountIcon}" Width="16" Height="16"></Image>
            </Button>

            <TextBlock Margin="5,3,5,3" Grid.Row="1" Grid.Column="0"  VerticalAlignment="Center" 
                       FontWeight="Bold" Foreground="{DynamicResource awsToolBarTextBrushKey}">Region:</TextBlock>
            <ComboBox Margin="5,3,5,3" Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="3"   
                      Name="_ctlRegions" SelectionChanged="onRegionChanged"
                      Style="{DynamicResource awsComboBoxStyle}">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <Image Margin="5,0,0,0" Width="13" Height="12" Source="{Binding FlagIcon}"/>
                            <TextBlock Margin="5,0,0,0" Text="{Binding DisplayName}" />
                        </StackPanel>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <Button Margin="0,3,0,3" Grid.Row="1" Grid.Column="4"  Click="onRegionRefreshClick" ToolTip="Refresh Regions">
                <Image DataContext="{DynamicResource CommonIcons}" Source="{Binding RefreshIcon}" Width="16" Height="16"></Image>
            </Button>

            <TextBlock Margin="5,3,5,3" Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="4" Name="_ctlErrorMessage" Foreground="Red" 
                       FontWeight="Bold" HorizontalAlignment="Center"/>
        </Grid>

        <TreeView Name="_ctlResourceTree" BorderThickness="0" 
                  HorizontalContentAlignment="Stretch" VerticalAlignment="Stretch" 
                  ItemsSource="{Binding Children}"  
                  MouseMove="resourceTree_MouseMove"
                  MouseDown="resourceTree_MouseDown"
                  ItemContainerStyle="{StaticResource navigatorTreeViewItemStyle}"
                  ScrollViewer.HorizontalScrollBarVisibility="Auto"
                  Background="{DynamicResource awsToolWindowBackgroundBrushKey}">

            <TreeView.ItemTemplate>
                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                    <StackPanel Orientation="Horizontal" x:Name="_tviPanel">
                        <Image Source="{Binding Icon}" Width="16" Height="16" Stretch="Fill"/>
                        <TextBlock Text="{Binding Name}" 
                                   ToolTip="{Binding ToolTip}" 
                                   TextDecorations="{Binding Path=(localnode:ITreeNodeProperties.TextDecoration)}"  
                                   Margin="5,0,5,0"
                                   Foreground="{DynamicResource awsToolWindowTextBrushKey}"/>
                    </StackPanel>
                    <HierarchicalDataTemplate.Triggers>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeViewItem}}}" Value="True" />
                                <Condition Binding="{Binding IsFocused, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TreeViewItem}}}" Value="False" />
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Background" TargetName="_tviPanel" Value="DarkGray" />
                        </MultiDataTrigger>
                    </HierarchicalDataTemplate.Triggers>
                </HierarchicalDataTemplate>

            </TreeView.ItemTemplate>
        </TreeView>
    </DockPanel>
</commonui:BaseAWSUserControl>

version: 0.2

phases:
  build:
    commands:
      - cmd /c mklink /J C:\src ${PWD}  # make a junction or we'll hit the path length limit
      - cd C:\src
      - $Version = Get-Content .\nextVersion | Out-String
      - $Version = $Version.Trim()
      - cmd /k "C:\BuildTools15\Common7\Tools\VsDevCmd.bat & msbuild buildtools\build.proj /p:Configuration=Release  /p:DeployExtension=false /p:UpdateVersions=true /p:AWSToolkitVersionNumber=$Version /t:update-version;build-vstoolkit-2017"
artifacts:
  discard-paths: yes
  files:
    - Deployment\**\*.vsix
    - buildtools\releaseartifacts\*
